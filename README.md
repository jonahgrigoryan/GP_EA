# GP_EA

You are an AI agent that autonomously plans, writes, and structures complete code projects. Your job is to create a full Genetic Programming (GP) implementation—both the Python DEAP workflow for evolving trading rules and the MQL5 integration for my existing Expert Advisor—so that I can use this EA’s signals to pass the FundingPips 2-Step Evaluation within 10 trading days (two calendar weeks). Top traders often finish in days; I want to make the EA ultra-profitable and compliant with all FundingPips constraints (≥10 trades, ≤5% max drawdown, +8% profit target).  

**Project context:**  
• I will provide you (codex) with my existing, back-tested `.mq5` file (the EA currently makes consistent, modest profits). It is located at `/mnt/data/MyExistingEA.mq5`. You’ll import or reference it as needed.  
• You must enhance this EA by hooking in a GP-evolved rule: generate a set of Python files under a `gp/` directory that:  
  1. Load historical M15 EURUSD data from `data/EURUSD_M15_in.csv` and `data/EURUSD_M15_out.csv`.  
  2. Define a DEAP primitive set (`primitives.py`) containing only indicators and operators that match what can be called in MQL5 (e.g., EMA50, EMA200, RSI14, ATR14, basic arithmetic, comparisons, an `if_func`).  
  3. Implement a fitness evaluator (`fitness.py`) that simulates trades exactly as FundingPips would measure them:  
     - Entry on fully closed M15 bars (shift=1), with an assumed 3-pip slippage buffer.  
     - ATR-based SL/TP identical to `helpers.mqh`.  
     - Lot sizing of 1% risk per trade.  
     - Penalize any individual whose equity drawdown exceeds 5% or whose trade count <10 in a two-week in-sample window, or whose net return <8%.  
  4. Create an evolution script (`evolve.py`) that:  
     - Builds the DEAP toolbox, runs a GP loop for at least 40 generations with population ~200, tournament selection, one‐point crossover, and uniform mutation.  
     - Saves the best individual to `best_tree.txt`.  
     - Calls an `export_rule.py` utility that converts the best individual into a MQL5 include file (`gp/gp_rule.mqh`).  
  5. Provide any helper modules (`utils.py`) for protected division, comparison functions, data loading, and TA computations (you may use Python’s `ta` library or implement rolling calculations).  

• Under `mql5/`, produce:  
  1. `gp_rule.mqh` (auto-generated by your Python code) containing a function `int GenerateGPTradeSignal(int shift)` that replicates the GP tree logic using `iMA`, `iRSI`, `iATR`, and nested `if` statements.  
  2. Modify my existing EA (`MyExistingEA.mq5`) so that wherever it formerly checked its old entry logic, it now calls `GenerateGPTradeSignal(1)` each new M15 bar. If `==1`, it issues a BUY alert; if `==–1`, issues a SELL alert; otherwise, does nothing. Keep my existing ATR SL/TP and `CalculateLotSize()` logic intact.  
  3. Ensure `helpers.mqh` (with `GetSLTP()`, `CalculateLotSize()`, `HasOpenPosition()`) is present.  

**Deliverables:**  
• A zipped folder containing:  
  - `data/EURUSD_M15_in.csv` (you can generate a placeholder with correct headers if needed) and `EURUSD_M15_out.csv` for out-of-sample validation.  
  - A `gp/` directory with all Python scripts: `primitives.py`, `fitness.py`, `evolve.py`, `export_rule.py`, `utils.py`, and any requirements (`requirements.txt`) listing `deap`, `pandas`, `numpy`, `ta`, etc.  
  - An `mql5/` directory with:  
    • `gp_rule.mqh` (from `export_rule.py`),  
    • `MyEnhancedEA.mq5` (adapted to call `GenerateGPTradeSignal()`),  
    • `helpers.mqh`.  

**Important constraints:**  
1. The GP implementation must strictly mimic the FundingPips rules: minimum 10 trades in a 10-day window, max 5% drawdown penalty, net +8% profit rewarded.  
2. All Python code should run in a Linux environment, saving files under the project tree.  
3. All MQL5 files must compile in MetaEditor without errors.  
4. The final zipped project should be runnable end-to-end: I can run `python gp/evolve.py` to generate `mql5/gp_rule.mqh`, then compile `MyEnhancedEA.mq5` in MT5, attach it to EURUSD M15, and observe alerts.  

**Primary objective:** Pass the FundingPips evaluation in 10 trading days by generating highly profitable, drawdown-controlled signals. Treat this as a competitive challenge: top traders finish in days. I want to finish in two weeks, so evolve an exceptionally robust entry/exit rule.  

Begin by outlining the file structure, then implement each file in turn, writing code to disk as appropriate. Finally, create the ZIP artifact and notify me when complete.  
``` :contentReference[oaicite:1]{index=1}
::contentReference[oaicite:2]{index=2}
